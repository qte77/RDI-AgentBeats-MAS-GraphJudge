@startuml EvaluationFlow
title GraphJudge Evaluation Flow (Collaborative Research Task)

skinparam participant {
    BackgroundColor<<Purple>> #E8D5F2
    BackgroundColor<<Green>> #C8E6C9
    BackgroundColor<<Eval>> #B3E5FC
    BackgroundColor<<Role>> #FFCDD2
}

actor "User" as User
participant "Green Agent" as Green <<Green>>
participant "TraceStore" as Store <<Green>>
participant "Coordinator" as Coord <<Role>>
participant "Researcher-1" as R1 <<Role>>
participant "Researcher-2" as R2 <<Role>>
participant "Graph\n(Tier 1)" as Graph <<Eval>>
participant "LLM Judge\n(Tier 2)" as LLM <<Eval>>
participant "Latency\n(Tier 2)" as Latency <<Eval>>

== Task Submission ==
User -> Green: "Research topic X"
activate Green
Green -> Coord: delegate task
activate Coord

== Hub-Spoke Coordination ==
Coord -> R1: subtask: "Find sources"
activate R1
Coord -> R2: subtask: "Analyze trends"
activate R2

R1 --> Coord: sources found
R1 ->> Store: POST /traces
deactivate R1

R2 --> Coord: trends analyzed
R2 ->> Store: POST /traces
deactivate R2

Coord -> Coord: synthesize results
Coord ->> Store: POST /traces
Coord --> Green: research summary
deactivate Coord

== Trace Aggregation ==
Green -> Store: get all traces
Store --> Green: InteractionStep[]

== Tiered Evaluation ==
Green -> Graph: evaluate(traces)
activate Graph
note right: Detects hub-spoke pattern\nCoordinator = high centrality
Graph --> Green: GraphMetrics
deactivate Graph

Green -> LLM: evaluate(summary, context)
activate LLM
note right: Assesses research quality\nCoordination effectiveness
LLM --> Green: LLMJudgment
deactivate LLM

Green -> Latency: evaluate(traces)
activate Latency
note right: Measures response times\nIdentifies bottlenecks
Latency --> Green: LatencyMetrics
deactivate Latency

== Response ==
Green --> User: {graph, llm_judgment, latency}
deactivate Green

@enduml
