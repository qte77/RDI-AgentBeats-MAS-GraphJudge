@startuml ComponentDiagram
title GraphJudge Component Architecture (Role-Based Coordination)

skinparam component {
    BackgroundColor<<Agent>> #E8D5F2
    BackgroundColor<<Core>> #C8E6C9
    BackgroundColor<<Eval>> #B3E5FC
    BackgroundColor<<External>> #FFECB3
    BackgroundColor<<Common>> #FFE0B2
    BackgroundColor<<Role>> #FFCDD2
}

skinparam package {
    BackgroundColor #FAFAFA
}

package "Common Module" <<Common>> #FFE0B2 {
    component [Models] as Models
    component [Messenger] as CommonMessenger
    component [TraceReporter] as TraceReporter
    component [PeerDiscovery] as PeerDiscovery
    component [LLMClient] as LLMFactory
}

package "Purple Agents (Role-Based)" <<Agent>> #E8D5F2 {

    package "Roles" <<Role>> #FFCDD2 {
        component [Coordinator] as CoordRole
        component [Researcher] as ResearchRole
        component [Synthesizer] as SynthRole
    }

    component [Executor\n(role dispatch)] as PurpleExec
    component [Settings\n(role, peers)] as PurpleSettings

    PurpleExec --> CoordRole
    PurpleExec --> ResearchRole
    PurpleExec --> SynthRole
    PurpleSettings --> PurpleExec
}

package "Green Agent (Assessor)" <<Core>> #C8E6C9 {

    package "Trace Collection" {
        component [TraceStore] as TraceStore
        component [/traces] as TracesEndpoint
        component [/peers] as PeersEndpoint
    }

    package "Evaluation (Tiered)" <<Eval>> #B3E5FC {
        component [Graph\n(Tier 1)] as GraphEval
        component [LLM Judge\n(Tier 2)] as LLMEval
        component [Latency\n(Tier 2)] as LatencyEval
    }

    component [Executor] as GreenExec
}

package "External" <<External>> #FFECB3 {
    component [LLM API] as LLMApi
}

' Common usage
Models --> PurpleExec
CommonMessenger --> CoordRole : A2A calls
TraceReporter --> PurpleExec : report traces
PeerDiscovery --> CoordRole : discover peers

' Role interactions (hub-spoke)
CoordRole --> ResearchRole : delegate
ResearchRole --> CoordRole : respond

' Trace flow
PurpleExec --> TracesEndpoint : POST /traces
TracesEndpoint --> TraceStore

' Peer discovery
CoordRole --> PeersEndpoint : GET /peers

' Evaluation
TraceStore --> GreenExec
GreenExec --> GraphEval
GreenExec --> LLMEval
GreenExec --> LatencyEval
LLMEval --> LLMApi

@enduml
