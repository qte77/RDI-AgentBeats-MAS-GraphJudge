# Gap Analysis: AgentBeats Leaderboard Compliance

This document tracks differences between the current implementation and AgentBeats leaderboard requirements based on the [agentbeats-debate-leaderboard](https://github.com/RDI-Foundation/agentbeats-debate-leaderboard) pattern.

## AgentBeats Output Structure Requirements

### Standard Pattern (from agentbeats-debate-leaderboard)

Following the standard AgentBeats leaderboard pattern as defined in `.github/workflows/agentbeats-run-scenario.yml`:

**Runtime Output:**
- **`output/results.json`** - Written by Green Agent during evaluation (REQUIRED)
- **`output/provenance.json`** - Build metadata (auto-generated by workflow)

**Leaderboard Submission** (managed by workflow):
- **`results/${USERNAME}-${TIMESTAMP}.json`** - Copied from `output/results.json` for leaderboard ranking
- **`submissions/${USERNAME}-${TIMESTAMP}.toml`** - Scenario configuration (from `scenario.toml`)
- **`submissions/${USERNAME}-${TIMESTAMP}.provenance.json`** - Build provenance and metadata

### Directory Structure

```text
output/                    # Runtime directory (Docker volume mount)
‚îú‚îÄ‚îÄ results.json          # Primary evaluation output (REQUIRED)
‚îî‚îÄ‚îÄ provenance.json       # Build metadata (auto-generated)

results/                   # Leaderboard results (Git-tracked)
‚îî‚îÄ‚îÄ ${USERNAME}-${TIMESTAMP}.json

submissions/               # Submission metadata (Git-tracked)
‚îú‚îÄ‚îÄ ${USERNAME}-${TIMESTAMP}.toml
‚îî‚îÄ‚îÄ ${USERNAME}-${TIMESTAMP}.provenance.json
```

## Current Implementation Status

### ‚úÖ Compliant

1. **Output path**: Implementation correctly uses `output/results.json`
   - File: `src/green/server.py:21` - `OUTPUT_FILE = Path("output/results.json")`
   - Tests: `tests/test_server.py:144` - Validates output to `output/results.json`

2. **Workflow integration**: `.github/workflows/agentbeats-run-scenario.yml` properly:
   - Creates `output/` directory (line 48)
   - Runs assessment with Docker Compose (line 76)
   - Records provenance (line 79)
   - Copies `output/results.json` to `results/${UNIQUE_NAME}.json` (line 93)
   - Copies scenario and provenance to `submissions/` (lines 92, 94)

3. **Directory structure**: Required directories exist with proper `.gitkeep` files

### ‚ö†Ô∏è Documentation Gaps (RESOLVED)

1. **PRD Documentation** - ‚úÖ FIXED
   - Updated `docs/GreenAgent-PRD.md` with AgentBeats Output Structure section
   - Added clear explanation of runtime vs. submission directories
   - Documented workflow-managed file copying

2. **prd.json Acceptance Criteria** - ‚úÖ FIXED
   - STORY-006: Clarified `output/results.json` is AgentBeats standard (NOT `results/`)
   - STORY-011: Added note that workflow copies to `results/` and `submissions/`

3. **Code Comments** - ‚úÖ FIXED
   - Added TODO comments in `src/green/server.py` and `tests/test_server.py`
   - Notes reference prd.json update requirement

### üîç Open Questions

1. **Results format**: What JSON schema should `output/results.json` follow?
   - Debate leaderboard: Judge scores with emotional appeal, clarity, etc.
   - Graph Judge: Graph metrics, LLM assessment, latency metrics
   - Action: Define schema in PRD or create JSON schema file

2. **Provenance generation**: How is `output/provenance.json` generated?
   - Workflow calls `record_provenance.py` (line 79)
   - Action: Review `scripts/leaderboard/record_provenance.py` implementation

3. **Scenario configuration**: Are there required fields in `scenario.toml`?
   - Current file has placeholder `agentbeats_id = ""`
   - Action: Document registration process and required fields

## Recommendations

### 1. Define Results JSON Schema

Create `docs/schemas/results.schema.json` documenting:
- Required fields (graph metrics, LLM scores, latency)
- Optional fields (confidence intervals, warnings)
- Version field for schema evolution

### 2. Document Submission Process

Add to `docs/AgentBeats/AGENTBEATS_SUBMISSION.md`:
- Step-by-step submission workflow
- How to interpret PR checks
- Leaderboard ranking criteria

### 3. Add Validation Script

Create `scripts/validate_results.py`:
- Validates `output/results.json` against schema
- Checks required fields before submission
- Runs automatically in CI/CD

## References

- [AgentBeats Debate Leaderboard](https://github.com/RDI-Foundation/agentbeats-debate-leaderboard)
- [Green Agent PRD](./GreenAgent-PRD.md)
- [AgentBeats Registration Guide](./AgentBeats/AGENTBEATS_REGISTRATION.md)

## Version History

- 2026-01-27: Initial gap analysis
- 2026-01-27: Resolved documentation gaps in PRD and prd.json
